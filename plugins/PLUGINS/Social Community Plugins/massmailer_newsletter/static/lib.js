$(document).ready(function(){$("input[name=site_accounts]").click(function(){$("input.accounts").attr("checked",$(this).is(":checked"))}),$("input.accounts").click(function(){$("input[name=site_accounts]").attr("checked",$("input.accounts:checked").length>0?!0:!1)}),$("input#confirm").click(function(){flynax.confirm(massmailer.phrases.send_confirm,massmailer.save,null)}),$("input#start_send").click(function(){flynax.confirm(massmailer.phrases.send_confirm,massmailer.start,null)})});var massmailerClass=function(){var e,t=this,n=width=percent=percent_value=0,a=!1;this.phrases=new Array,this.config=new Array,this.save=function(){$("input#confirm").val(lang.loading);var e=new Array;$("input.accounts:checked").each(function(){e.push($(this).val())}),xajax_massmailerSave(t.config.id,$("input[name=from_mail]").val(),$("input[name=status]").val(),$("input[name=subject]").val(),CKEDITOR.instances.body.getData(),$("input[name=newsletters_accounts]").is(":checked")?1:0,e.join(","),$("input[name=contact_us]").is(":checked")?1:0)},this.send=function(i,o){0==o&&(a||(a=new Ext.Window({applyTo:"statistic",layout:"fit",width:447,height:140,closeAction:"hide",plain:!0}),a.addListener("hide",function(){t.stop()})),a.show()),e=$.getJSON("../plugins/massmailer_newsletter/admin/send.php",{id:i,index:o},function(e){0==o&&(n=Math.ceil(362/e.count),percent_value=Math.ceil(100/e.count)),o++,width+=n,percent=e.count==o?100:percent+percent_value,$("#total").html(e.count),$("#sent").html(o),$("#processing").css("width",width+"px"),$("#loading_percent").html(percent+"%"),$("#sending").html(e.data.Mail),e.count>o?t.send(i,o):(printMessage("notice",t.phrases.completed.replace("{count}",e.count)),setTimeout(function(){a.hide(),t.clear()},4e3))})},this.stop=function(){e.abort()},this.start=function(){t.send(t.config.id,0)},this.clear=function(){n=width=percent=percent_value=0,$("#total").html(0),$("#sent").html(0),$("#processing").css("width","0px"),$("#loading_percent").html("0%"),$("#sending").html("-")}},massmailer=new massmailerClass;