<?xml version="1.0" encoding="utf-8" ?>
<plugin name="polls">
	<title>Polls</title>
	<description>Allow to create polls blocks in Front End</description>
	<author>Viktor S.</author>
	<owner>Flynax Classifieds Software</owner>
	<version>2.1.5</version>
	<date>01.06.2012</date>
	<controller>polls</controller>

	<files>
		<file>polls.block.tpl</file>
		<file>rlPolls.class.php</file>
		<file>static/polls.css</file>
		<file>static/style.css</file>
		<file>static/select.png</file>
		<file>admin/polls.inc.php</file>
		<file>admin/polls.tpl</file>
	</files>
	
	<install><![CDATA[
	global $rlDb;
	
	$sql = "
	CREATE TABLE `".RL_DBPREFIX."polls` (
	`ID` int(11) NOT NULL auto_increment,
	`Date` datetime NOT NULL default '0000-00-00 00:00:00',
	`Side` varchar(15) NOT NULL default '',
	`Tpl` enum('1','0') NOT NULL default '1',
	`Random` enum('1','0') NOT NULL default '0',
	`Status` enum('active','approval') NOT NULL default 'active',
	PRIMARY KEY  (`ID`),
	KEY `Status` (`Status`)
	) CHARSET=utf8";
	
	$rlDb -> query($sql);
	
	$sql = "
	CREATE TABLE `".RL_DBPREFIX."polls_items` (
	`ID` int(11) NOT NULL auto_increment,
	`Poll_ID` int(11) NOT NULL default '0',
	`Votes` int(9) NOT NULL default '0',
	`Color` varchar(10) NOT NULL default '',
	PRIMARY KEY  (`ID`),
	KEY `Poll_ID` (`Poll_ID`)
	) CHARSET=utf8";
	
	$rlDb -> query($sql);
	]]>
	</install>

	<hooks>
		<hook name="specialBlock" version="2.1.5"><![CDATA[
			global $block_keys, $rlXajax;

			if ( preg_match("/polls_?/", join(",", array_keys($block_keys))) > 0 )
			{
				$GLOBALS['reefless'] -> loadClass('Polls', null, 'polls');
				$rlXajax -> registerFunction( array( 'vote', $GLOBALS['rlPolls'], 'ajaxVote' ) );
			}
			]]></hook>
		<hook name="apTplHeader"><![CDATA[
			if( $_GET['controller'] == 'polls' && ($_GET['action'] == 'add' || $_GET['action'] == 'edit') )
			{
				echo '<script type="text/javascript" src="'.RL_LIBS_URL.'jquery/colorpicker/js/colorpicker.js"></script>
				<link rel="stylesheet" type="text/css" href="'.RL_PLUGINS_URL.'polls/static/polls.css" />';
			}
			]]></hook>

		<hook name="tplHeader"><![CDATA[
				echo '<link rel="stylesheet" type="text/css" href="'.RL_PLUGINS_URL.'polls/static/style.css" />';
			]]></hook>
	</hooks>

	<phrases>
		<phrase key="total_votes" module="common"><![CDATA[Total votes]]></phrase>
		<phrase key="polls_not_created" module="frontEnd"><![CDATA[Polls not created]]></phrase>
		<phrase key="vote" module="frontEnd"><![CDATA[Vote]]></phrase>
		<phrase key="notice_vote_accepted" module="frontEnd"><![CDATA[Your vote has been accepted, thank you for participation.]]></phrase>
		<phrase key="vote_items" module="admin"><![CDATA[Vote items]]></phrase>
		<phrase key="ext_results" module="ext"><![CDATA[Results]]></phrase>
		<phrase key="view_results" module="admin"><![CDATA[View Results]]></phrase>
		<phrase key="votes" module="common"><![CDATA[Votes]]></phrase>
		<phrase key="polls_view_results" module="common"><![CDATA[View results]]></phrase>
		<phrase key="polls_back_for_vote" module="common"><![CDATA[Back for vote]]></phrase>
		<phrase key="polls_color" module="admin"><![CDATA[Color]]></phrase>
		<phrase key="polls_use_create_in_own" module="common"><![CDATA[Create in own box]]></phrase>
		<phrase key="ext_polls_use_create_in_own" module="ext"><![CDATA[In own box]]></phrase>
		<phrase key="ext_polls_manager" module="ext"><![CDATA[Polls manager]]></phrase>
		<phrase key="ext_notice_delete_poll" module="ext"><![CDATA[Are you sure you want to delete the poll?]]></phrase>
	</phrases>
	
	<blocks>
		<block key="polls" login="0" name="Polls" side="left" type="php" tpl="1"><![CDATA[
			global $rlSmarty;$poll = "";$rlSmarty -> assign("poll", $poll);$rlSmarty -> display(RL_PLUGINS."polls".RL_DS."polls.block.tpl");
		]]></block>
	</blocks>
	
	<updates>
		<update version="2.1.0" files="polls.block.tpl,static/style.css"><![CDATA[]]></update>
		<update version="2.1.1" files="admin/polls.inc.php,rlPolls.class.php"><![CDATA[]]></update>
		<update version="2.1.2" files="admin/polls.inc.php,rlPolls.class.php,static/style.css"><![CDATA[]]></update>
		<update version="2.1.3" files="rlPolls.class.php"><![CDATA[]]></update>
		<update version="2.1.4"><![CDATA[]]></update>
		<update version="2.1.5"><![CDATA[]]></update>
	</updates>
	
	<uninstall><![CDATA[
	global $rlDb;
	$sql = "DROP TABLE `".RL_DBPREFIX."polls`";
	$rlDb -> query($sql);
	
	$sql = "DROP TABLE `".RL_DBPREFIX."polls_items`";
	$rlDb -> query($sql);
	]]>
	</uninstall>
</plugin>
