!function(e){e.widget("rl.carousel",{options:{btnPrev:null,btnNext:null,auto:null,arrow_margin:25,speed:1e3,diraction:"ltr",vertical:!1,circular:!1,visible:4,start:0,scroll:1,number:0,count:0},_create:function(){this.options.vertical||(this._elements(),this._checkVisible()),this.options.scroll>this.options.visible&&(this.options.scroll=this.options.visible),this.options.circular&&(this._elements(),this._circular()),this._elements(),this._build(),this._removeActionBlock(),this._addNextPrevActions(),this.options.auto&&this._bindAutoScroll()},_elements:function(){var e=this.elements={};e.curr=0,e.interval=0,e.running=!1,e.id=this.element.attr("id"),e.ul=this.element.children("ul"),e.items=e.ul.children("li"),e.count=e.items.size()},_build:function(){elems=this.elements,this.options.vertical?(elems.animCss="top",elems.sizeCss="height",elems.liSize=this._height(),elems.divSize=elems.liSize*this.options.visible,elems.ulSize=elems.liSize+(this.options.number+elems.count),elems.marginLi=parseInt((this.element.width()-elems.items.width())/2),elems.items.css({height:elems.liSize,marginLeft:elems.marginLi+"px",marginRight:elems.marginLi+"px"}),this.element.css(elems.sizeCss,elems.divSize+"px"),elems.ul.css("position","absolute"),elems.ul.css(elems.sizeCss,elems.ulSize+(elems.liSize+2*elems.marginLi)+"px").css(elems.animCss,0)):(elems.animCss="rtl"==this.options.diraction?"right":"left",elems.sizeCss="width",elems.liSize=elems.items.width(),elems.divSize=e(this.element).closest(".ling_top_block").length>0?this.element.parent().width():this.element.parent().width()-2*this.options.arrow_margin,elems.marginLi=parseInt((elems.divSize-elems.liSize*this.options.visible)/(2*this.options.visible)),elems.ulSize=(elems.liSize+2*elems.marginLi)*(this.options.number+elems.count),elems.items.css({width:elems.items.width(),marginLeft:elems.marginLi+"px",marginRight:elems.marginLi+"px"}),"rtl"==this.options.diraction&&elems.items.css("float","right"),elems.liSize=elems.liSize+2*elems.marginLi,e(this.element).closest(".ling_top_block").length>0?this.element.css("height",this._height()+"px"):this.element.css({marginLeft:this.options.arrow_margin+"px",marginRight:this.options.arrow_margin+"px",height:this._height()+"px"}),this.element.css(elems.sizeCss,elems.divSize+"px"),elems.ul.css("position","absolute"),elems.ul.css(elems.sizeCss,elems.ulSize+"px").css(elems.animCss,0))},_checkVisible:function(){var e=this,t=this.elements,i=this.options;d_w=parseInt((e.element.width()-2*i.arrow_margin)/t.items.width()),i.visible=d_w<i.visible?d_w:i.visible},_removeActionBlock:function(){e(this.element).closest(".content_block").find("[onClick]").removeAttr("onClick"),e(this.element).closest(".side_block").find("[onClick]").removeAttr("onClick")},_height:function(){max_height="";for(var e=0;e<this.options.count;e++)max_height<this.elements.items.eq(e).height()&&(max_height=this.elements.items.eq(e).height());return max_height},_circular:function(){this.elements.ul.append(this.elements.items.slice(0).clone())},_addNextPrevActions:function(){if(this.options.btnPrev&&this.options.btnNext){var t=this;this.elements,this.options,this.element.before('<div class="'+this.options.btnNext.replace(".","")+' next" ></div><div class="'+this.options.btnPrev.replace(".","")+' prev" ></div>'),e(this.element).closest(".ling_top_block").length>0&&(e(this.options.btnNext).css("right","-20px"),e(this.options.btnPrev).css("left","-20px")),e(this.options.btnNext).bind("click",function(){t.next()}),e(this.options.btnPrev).bind("click",function(){t.prev()})}},next:function(){return this.options.auto&&this._iterval(),this._slide(this.elements.curr,"next")},prev:function(){return this.options.auto&&this._iterval(),this._slide(this.elements.curr,"prev")},_iterval:function(){var e=this;this.elements,this.options,clearInterval(e.elements.interval),this._bindAutoScroll()},_bindAutoScroll:function(){var e=this,t=this.elements,i=this.options;e.elements.interval=setInterval(function(){e._slide(t.curr,"next")},i.auto)},_beforeStart:function(){var e=this.elements,t=this.options;e.count!=e.ul.children("li").size()&&(e.items=e.ul.children("li"),e.count=e.items.size(),t.vertical?e.items.css({height:e.liSize,marginLeft:e.marginLi+"px",marginRight:e.marginLi+"px"}):e.items.css({width:e.items.width(),marginLeft:e.marginLi+"px",marginRight:e.marginLi+"px"}),"rtl"==this.options.diraction&&e.items.css("float","right"))},_afterLoadAjax:function(){var e=this;this.elements,this.options,e._beforeStart(),e._animate()},_slide:function(e,t){var i=this,n=this.elements,a=this.options;if(!n.running){if(curr="next"==t?e+this.options.scroll:e-this.options.scroll,a.circular)if(0>=curr)if(0==e){if("ltr"==a.diraction&&"prev"==t&&rlCarousel[n.id]>0||"rtl"==a.diraction&&"prev"==t&&rlCarousel[n.id]>0)return;n.ul.css(n.animCss,-((n.count-a.count)*n.liSize)+"px"),curr=n.count-a.count-a.scroll}else 0>curr&&(curr=0);else curr>=n.count-a.count&&(e==n.count-a.visible?(n.ul.css(n.animCss,-(a.count-a.visible)*n.liSize+"px"),curr=a.count-a.visible+a.scroll):curr+a.visible>n.count&&(curr=n.count-a.visible));else{if(0>curr||curr>n.count-a.visible)return;curr=curr}n.curr=curr,rlCarousel[n.id]>0?(carent_id=a.circular?n.count-a.count-1:n.count-1,n.running=!0,xajax_loadListings(carent_id,a.scroll,a.options,rlCarousel[n.id],a.priceTag)):(n.running=!0,i._animate())}},_animate:function(){var e=this.elements,t=this.options;"right"==e.animCss?e.ul.animate({right:-(e.curr*e.liSize)},t.speed,t.easing,function(){e.running=!1}):e.ul.animate("left"==e.animCss?{left:-(e.curr*e.liSize)}:{top:-(e.curr*e.liSize)},t.speed,t.easing,function(){e.running=!1})}})}(jQuery);